{
  "backgroundColor": "#FFFFFF",
  "borderColor": "#E0DEDE",
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": "1",
  "bottomRow": 35,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "defaultModel": "{{ appsmith.store.visitsUI || JS_VisitsFilter.processData() }}\n",
  "dynamicBindingPathList": [
    {
      "key": "theme"
    },
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "defaultModel"
    }
  ],
  "dynamicHeight": "AUTO_HEIGHT",
  "dynamicPropertyPathList": [
    {
      "key": "onAddVisit"
    }
  ],
  "dynamicTriggerPathList": [
    {
      "key": "onAddVisit"
    }
  ],
  "events": [
    "onAddVisit"
  ],
  "isCanvas": false,
  "isLoading": false,
  "isSearchWildcard": true,
  "isVisible": true,
  "key": "en7wr6rd6j",
  "leftColumn": 0,
  "maxDynamicHeight": 9000,
  "minDynamicHeight": 4,
  "mobileBottomRow": 31,
  "mobileLeftColumn": 38,
  "mobileRightColumn": 61,
  "mobileTopRow": 1,
  "needsErrorInfo": false,
  "onAddVisit": "{{ \n  (async () => {\n    await VisitAdd.manual();                       // tu lógica actual\n    await getClientVisitsQuery.run();              // refresca progreso\n    await getFallbackVisitsCount.run();            // por si aplica\n    await visitsLogic.processData();               // vuelve a llenar appsmith.store.visitsUI\n    await q_visitas_historial.run({\n      customerId: appsmith.store.selCustomerId,\n      limit: 500, offset: 0\n    });\n  })()\n}}\n",
  "originalBottomRow": 28,
  "originalTopRow": 5,
  "parentColumnSpace": 10.678878784179688,
  "parentId": "g2mlnelos6",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "rightColumn": 63,
  "shouldScrollContents": true,
  "srcDoc": {
    "css": "@charset \"UTF-8\";\n:root {\n  --card-bg: #ffffff;\n  --card-bdr: #e5e7eb;\n  --text: #111827;\n  --muted: #6b7280;\n  --blue: #3b82f6;\n  --gray-pill: #f3f4f6;\n  --green: #10b981;\n}\n\n* {\n  box-sizing: border-box;\n}\n\n.card {\n  background: var(--card-bg);\n  border: 1px solid var(--card-bdr);\n  border-radius: 14px;\n  padding: 16px;\n  color: var(--text);\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n}\n\n.header h3 {\n  margin: 0;\n  font-size: 16px;\n  font-weight: 700;\n}\n\n.badges {\n  display: inline-flex;\n  gap: 8px;\n}\n\n.badge {\n  display: inline-flex;\n  align-items: center;\n  padding: 6px 10px;\n  border-radius: 999px;\n  font-size: 12px;\n  line-height: 1;\n  border: 1px solid transparent;\n}\n\n.badge-gray {\n  background: var(--gray-pill);\n  color: var(--text);\n}\n\n.badge-blue {\n  background: rgba(59, 130, 246, 0.12);\n  color: var(--blue);\n  border-color: rgba(59, 130, 246, 0.2);\n}\n\n.badge.done {\n  background: rgba(16, 185, 129, 0.12);\n  color: var(--green);\n  border-color: rgba(16, 185, 129, 0.2);\n}\n\n/* GRID */\n.grid {\n  display: grid;\n  grid-template-columns: repeat(5, 1fr); /* normal: 10 slots (5x2) */\n  gap: 12px;\n}\n\n/* si es VIP, el JS añade .vip al grid → 4 columnas */\n.grid.vip {\n  grid-template-columns: repeat(4, 1fr);\n}\n\n/* Slot */\n.slot {\n  display: grid;\n  place-items: center;\n  height: 56px;\n  border-radius: 12px;\n  border: 1px solid var(--card-bdr);\n  background: #f9fafb;\n  color: var(--muted);\n  font-weight: 600;\n  user-select: none;\n  cursor: default;\n  transition: transform 0.06s ease, background 0.2s ease, color 0.2s ease, border-color 0.2s ease;\n}\n\n.slot:hover {\n  transform: translateY(-1px);\n}\n\n.slot.active {\n  background: var(--blue);\n  color: white;\n  border-color: var(--blue);\n}\n\n.slot.done {\n  background: #ecfdf5;\n  color: var(--green);\n  border-color: rgba(16, 185, 129, 0.35);\n}",
    "html": "<div class=\"card\">\n  <div class=\"header\">\n    <h3 id=\"title\">Tarjeta de visitas</h3>\n    <div class=\"badges\">\n      <span id=\"badge50\"  class=\"badge badge-gray\" hidden>5 para 50%</span>\n      <span id=\"badgeFree\" class=\"badge badge-blue\"  hidden>10 para gratis</span>\n    </div>\n  </div>\n\n  <div id=\"grid\" class=\"grid\"></div>\n</div>\n",
    "js": "// ===== utilidades de estilos (mismos colores que el diseño) =====\nconst COLORS = {\n  slotFilledBg: '#2F6FEB',\n  slotFilledText: '#FFFFFF',\n  slotEmptyBg: '#EEF2F7',\n  slotEmptyText: '#8A93A5',\n  badgeGrayBg: '#E5E7EB',\n  badgeGrayText: '#374151',\n  badgeGreenBg: '#D1FAE5',\n  badgeGreenText: '#065F46',\n  badgeBlueBg: '#DBEAFE',\n  badgeBlueText: '#1E40AF'\n};\n\n// Devuelve texto seguro\nconst txt = (v, def = '') => v == null ? def : String(v);\n\n// Dibuja una \"pastilla\" (badge)\nfunction paintBadge(el, text, completed, theme /*'green'|'blue'|'gray'*/) {\n  if (!el) return;\n  if (!text) {\n    el.hidden = true;\n    el.style.display = 'none';\n    return;\n  }\n  el.hidden = false;\n  el.style.display = 'inline-block';\n  el.textContent = text;\n  let bg = COLORS.badgeGrayBg;\n  let fg = COLORS.badgeGrayText;\n  if (theme === 'green') {\n    bg = completed ? COLORS.badgeGreenBg : COLORS.badgeGrayBg;\n    fg = completed ? COLORS.badgeGreenText : COLORS.badgeGrayText;\n  } else if (theme === 'blue') {\n    bg = completed ? COLORS.badgeBlueBg : COLORS.badgeGrayBg;\n    fg = completed ? COLORS.badgeBlueText : COLORS.badgeGrayText;\n  }\n  el.style.background = bg;\n  el.style.color = fg;\n}\n\n// Crea un botón-casilla\nfunction createSlotButton(slot, model) {\n  const btn = document.createElement('button');\n  btn.className = 'slot';\n  btn.textContent = slot.value;\n\n  // estilo según \"filled\"\n  btn.style.background = slot.filled ? COLORS.slotFilledBg : COLORS.slotEmptyBg;\n  btn.style.color = slot.filled ? COLORS.slotFilledText : COLORS.slotEmptyText;\n\n  // redondeado y altura consistente\n  btn.style.border = '0';\n  btn.style.borderRadius = '14px';\n  btn.style.height = '64px';\n  btn.style.fontWeight = '700';\n  btn.style.fontSize = '18px';\n  btn.style.cursor = 'pointer';\n\n  // Evento click → registrar visita\n  btn.addEventListener('click', () => {\n    appsmith.triggerEvent('onAddVisit', {\n      slot: slot.value,\n      model\n    });\n  });\n  return btn;\n}\n\n// Render principal\nfunction render(model) {\n  const titleEl = document.getElementById('title');\n  const badge50El = document.getElementById('badge50');\n  const badgeFreeEl = document.getElementById('badgeFree');\n  const gridEl = document.getElementById('grid');\n  if (!titleEl || !badge50El || !badgeFreeEl || !gridEl) {\n    console.warn('[custom] Faltan nodos en HTML. Revisa ids: title, badge50, badgeFree, grid');\n    return;\n  }\n\n  // === Datos del modelo ===\n  const planName = txt(model.planName).toLowerCase();\n  const tagName = txt(model.tag).toLowerCase();\n  const currentVisits = Number(model.currentVisits || 0);\n  const totalSlots = Number(model.totalSlots || 10);\n\n  // VIP si: flag explícito, o plan/tag contienen \"vip\"\n  const isVip = Boolean(model.isVip) || /vip/i.test(planName) || /vip/i.test(tagName);\n\n  // --- Textos adaptativos ---\n  let headerText = '';\n  let prize1 = null;\n  let prize2 = null;\n  if (isVip) {\n    const target = 4;\n    headerText = currentVisits < target ? `VIP: ¡Solo ${target - currentVisits} visitas para el Gratis!` : '¡Premio VIP listo para canjear!';\n    prize1 = {\n      text: `${target} para Servicio Gratis (VIP)`,\n      completed: currentVisits >= target\n    };\n    prize2 = null;\n  } else {\n    const target50 = 5;\n    const targetGratis = 10;\n    if (currentVisits < target50) {\n      headerText = `¡Solo ${target50 - currentVisits} para 50%!`;\n    } else if (currentVisits < targetGratis) {\n      headerText = `¡Solo ${targetGratis - currentVisits} para Gratis!`;\n    } else {\n      headerText = '¡Ambos premios listos para canjear!';\n    }\n    prize1 = {\n      text: `${target50} para 50% de Descuento`,\n      completed: currentVisits >= target50\n    };\n    prize2 = {\n      text: `${targetGratis} para Servicio Gratis`,\n      completed: currentVisits >= targetGratis\n    };\n  }\n\n  // --- Aplicar valores al DOM ---\n  titleEl.textContent = headerText;\n  if (isVip) {\n    // Oculta REAL el badge 50%\n    badge50El.hidden = true;\n    badge50El.style.display = 'none';\n\n    // Muestra solo el de Gratis (VIP)\n    paintBadge(badgeFreeEl, prize1.text, !!prize1.completed, 'blue');\n  } else {\n    paintBadge(badge50El, prize1.text, !!prize1.completed, 'green');\n    paintBadge(badgeFreeEl, prize2.text, !!prize2.completed, 'blue');\n  }\n\n  // --- Grilla de slots ---\n  const slots = Array.isArray(model.slots) ? model.slots : [];\n  gridEl.innerHTML = '';\n  gridEl.style.display = 'grid';\n  gridEl.style.gap = '16px';\n  // 2 columnas si VIP (4 slots), 5 columnas si normal (hasta 10)\n  const cols = isVip ? 2 : Math.min(5, Math.max(2, totalSlots || slots.length || 10));\n  gridEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;\n  slots.forEach(s => gridEl.appendChild(createSlotButton(s, model)));\n}\n\n// ========== Ciclo de vida del Custom Widget ==========\nappsmith.onReady(() => {\n  const initialModel = appsmith.model || {};\n  render(initialModel);\n});\nappsmith.onModelChange = newModel => {\n  render(newModel || {});\n};"
  },
  "theme": "{{appsmith.theme}}",
  "topRow": 8,
  "type": "CUSTOM_WIDGET",
  "uncompiledSrcDoc": {
    "css": ":root {\n  --card-bg: #ffffff;\n  --card-bdr: #e5e7eb;\n  --text: #111827;\n  --muted: #6b7280;\n  --blue: #3b82f6;\n  --gray-pill: #f3f4f6;\n  --green: #10b981;\n}\n\n* { box-sizing: border-box; }\n\n.card {\n  background: var(--card-bg);\n  border: 1px solid var(--card-bdr);\n  border-radius: 14px;\n  padding: 16px;\n  color: var(--text);\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 12px;\n}\n\n.header h3 {\n  margin: 0;\n  font-size: 16px;\n  font-weight: 700;\n}\n\n.badges {\n  display: inline-flex;\n  gap: 8px;\n}\n\n.badge {\n  display: inline-flex;\n  align-items: center;\n  padding: 6px 10px;\n  border-radius: 999px;\n  font-size: 12px;\n  line-height: 1;\n  border: 1px solid transparent;\n}\n\n.badge-gray {\n  background: var(--gray-pill);\n  color: var(--text);\n}\n\n.badge-blue {\n  background: rgba(59,130,246,.12);\n  color: var(--blue);\n  border-color: rgba(59,130,246,.2);\n}\n\n.badge.done {\n  background: rgba(16,185,129,.12);\n  color: var(--green);\n  border-color: rgba(16,185,129,.2);\n}\n\n/* GRID */\n.grid {\n  display: grid;\n  grid-template-columns: repeat(5, 1fr); /* normal: 10 slots (5x2) */\n  gap: 12px;\n}\n\n/* si es VIP, el JS añade .vip al grid → 4 columnas */\n.grid.vip {\n  grid-template-columns: repeat(4, 1fr);\n}\n\n/* Slot */\n.slot {\n  display: grid;\n  place-items: center;\n  height: 56px;\n  border-radius: 12px;\n  border: 1px solid var(--card-bdr);\n  background: #f9fafb;\n  color: var(--muted);\n  font-weight: 600;\n  user-select: none;\n  cursor: default;\n  transition: transform .06s ease, background .2s ease, color .2s ease, border-color .2s ease;\n}\n\n.slot:hover { transform: translateY(-1px); }\n\n.slot.active {\n  background: var(--blue);\n  color: white;\n  border-color: var(--blue);\n}\n\n.slot.done {\n  background: #ecfdf5;\n  color: var(--green);\n  border-color: rgba(16,185,129,.35);\n}\n",
    "html": "<div class=\"card\">\n  <div class=\"header\">\n    <h3 id=\"title\">Tarjeta de visitas</h3>\n    <div class=\"badges\">\n      <span id=\"badge50\"  class=\"badge badge-gray\" hidden>5 para 50%</span>\n      <span id=\"badgeFree\" class=\"badge badge-blue\"  hidden>10 para gratis</span>\n    </div>\n  </div>\n\n  <div id=\"grid\" class=\"grid\"></div>\n</div>\n",
    "js": "// ===== utilidades de estilos (mismos colores que el diseño) =====\nconst COLORS = {\n  slotFilledBg: '#2F6FEB',\n  slotFilledText: '#FFFFFF',\n  slotEmptyBg: '#EEF2F7',\n  slotEmptyText: '#8A93A5',\n\n  badgeGrayBg: '#E5E7EB',\n  badgeGrayText: '#374151',\n\n  badgeGreenBg: '#D1FAE5',\n  badgeGreenText: '#065F46',\n\n  badgeBlueBg: '#DBEAFE',\n  badgeBlueText: '#1E40AF',\n};\n\n// Devuelve texto seguro\nconst txt = (v, def = '') => (v == null ? def : String(v));\n\n// Dibuja una \"pastilla\" (badge)\nfunction paintBadge(el, text, completed, theme /*'green'|'blue'|'gray'*/) {\n  if (!el) return;\n  if (!text) {\n    el.hidden = true;\n    el.style.display = 'none';\n    return;\n  }\n  el.hidden = false;\n  el.style.display = 'inline-block';\n  el.textContent = text;\n\n  let bg = COLORS.badgeGrayBg;\n  let fg = COLORS.badgeGrayText;\n\n  if (theme === 'green') {\n    bg = completed ? COLORS.badgeGreenBg : COLORS.badgeGrayBg;\n    fg = completed ? COLORS.badgeGreenText : COLORS.badgeGrayText;\n  } else if (theme === 'blue') {\n    bg = completed ? COLORS.badgeBlueBg : COLORS.badgeGrayBg;\n    fg = completed ? COLORS.badgeBlueText : COLORS.badgeGrayText;\n  }\n  el.style.background = bg;\n  el.style.color = fg;\n}\n\n// Crea un botón-casilla\nfunction createSlotButton(slot, model) {\n  const btn = document.createElement('button');\n  btn.className = 'slot';\n  btn.textContent = slot.value;\n\n  // estilo según \"filled\"\n  btn.style.background = slot.filled ? COLORS.slotFilledBg : COLORS.slotEmptyBg;\n  btn.style.color = slot.filled ? COLORS.slotFilledText : COLORS.slotEmptyText;\n\n  // redondeado y altura consistente\n  btn.style.border = '0';\n  btn.style.borderRadius = '14px';\n  btn.style.height = '64px';\n  btn.style.fontWeight = '700';\n  btn.style.fontSize = '18px';\n  btn.style.cursor = 'pointer';\n\n  // Evento click → registrar visita\n  btn.addEventListener('click', () => {\n    appsmith.triggerEvent('onAddVisit', { slot: slot.value, model });\n  });\n\n  return btn;\n}\n\n// Render principal\nfunction render(model) {\n  const titleEl = document.getElementById('title');\n  const badge50El = document.getElementById('badge50');\n  const badgeFreeEl = document.getElementById('badgeFree');\n  const gridEl = document.getElementById('grid');\n\n  if (!titleEl || !badge50El || !badgeFreeEl || !gridEl) {\n    console.warn('[custom] Faltan nodos en HTML. Revisa ids: title, badge50, badgeFree, grid');\n    return;\n  }\n\n  // === Datos del modelo ===\n  const planName = txt(model.planName).toLowerCase();\n  const tagName  = txt(model.tag).toLowerCase();\n  const currentVisits = Number(model.currentVisits || 0);\n  const totalSlots    = Number(model.totalSlots || 10);\n\n  // VIP si: flag explícito, o plan/tag contienen \"vip\"\n  const isVip = Boolean(model.isVip) || /vip/i.test(planName) || /vip/i.test(tagName);\n\n  // --- Textos adaptativos ---\n  let headerText = '';\n  let prize1 = null;\n  let prize2 = null;\n\n  if (isVip) {\n    const target = 4;\n    headerText = currentVisits < target\n      ? `VIP: ¡Solo ${target - currentVisits} visitas para el Gratis!`\n      : '¡Premio VIP listo para canjear!';\n\n    prize1 = { text: `${target} para Servicio Gratis (VIP)`, completed: currentVisits >= target };\n    prize2 = null;\n  } else {\n    const target50 = 5;\n    const targetGratis = 10;\n\n    if (currentVisits < target50) {\n      headerText = `¡Solo ${target50 - currentVisits} para 50%!`;\n    } else if (currentVisits < targetGratis) {\n      headerText = `¡Solo ${targetGratis - currentVisits} para Gratis!`;\n    } else {\n      headerText = '¡Ambos premios listos para canjear!';\n    }\n\n    prize1 = { text: `${target50} para 50% de Descuento`, completed: currentVisits >= target50 };\n    prize2 = { text: `${targetGratis} para Servicio Gratis`, completed: currentVisits >= targetGratis };\n  }\n\n  // --- Aplicar valores al DOM ---\n  titleEl.textContent = headerText;\n\n  if (isVip) {\n    // Oculta REAL el badge 50%\n    badge50El.hidden = true;\n    badge50El.style.display = 'none';\n\n    // Muestra solo el de Gratis (VIP)\n    paintBadge(badgeFreeEl, prize1.text, !!prize1.completed, 'blue');\n  } else {\n    paintBadge(badge50El, prize1.text, !!prize1.completed, 'green');\n    paintBadge(badgeFreeEl, prize2.text, !!prize2.completed, 'blue');\n  }\n\n  // --- Grilla de slots ---\n  const slots = Array.isArray(model.slots) ? model.slots : [];\n  gridEl.innerHTML = '';\n\n  gridEl.style.display = 'grid';\n  gridEl.style.gap = '16px';\n  // 2 columnas si VIP (4 slots), 5 columnas si normal (hasta 10)\n  const cols = isVip ? 2 : Math.min(5, Math.max(2, totalSlots || slots.length || 10));\n  gridEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;\n\n  slots.forEach((s) => gridEl.appendChild(createSlotButton(s, model)));\n}\n\n// ========== Ciclo de vida del Custom Widget ==========\nappsmith.onReady(() => {\n  const initialModel = appsmith.model || {};\n  render(initialModel);\n});\n\nappsmith.onModelChange = (newModel) => {\n  render(newModel || {});\n};\n"
  },
  "version": 1,
  "widgetId": "uzbe620ite",
  "widgetName": "Tarjeta_Visita"
}