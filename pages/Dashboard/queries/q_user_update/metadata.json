{
  "gitSyncId": "68f1ea66301c3b6f3e13c5f4_da5122ff-eba0-49f9-8a1a-fdb8a29793b8",
  "id": "Dashboard_q_user_update",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH v AS (\n\tSELECT\n\t{{ appsmith.store.businessId }}::uuid AS bid,\n\t{{ this.params.id }}::uuid            AS uid,\n\tupper(trim(COALESCE({{ this.params.role }}, '')))     AS role_raw,\n\tnullif(trim({{ this.params.first_name || '' }}), '')   AS first_name,\n\tnullif(trim({{ this.params.last_name  || '' }}), '')   AS last_name,\n\tnullif(trim({{ this.params.phone      || '' }}), '')   AS phone,\n\t(CASE WHEN {{ this.params.is_active }} IS NULL\n\t THEN NULL\n\t ELSE ({{ this.params.is_active }}::text)::boolean\n\t END) AS is_active,\n\tlower(trim(\n\t\tCOALESCE({{ this.params.updated_by_email }},\n\t\t\t\t\t\t {{ appsmith.store.userEmail }},\n\t\t\t\t\t\t {{ appsmith.user.email }},\n\t\t\t\t\t\t '')\n\t)) AS updated_by_email\n),\nupd_by AS (\n\tSELECT u.id AS updated_by_id\n\tFROM \"User\" u, v\n\tWHERE u.\"businessId\" = v.bid\n\tAND lower(u.email) = v.updated_by_email\n\tLIMIT 1\n),\nto_update AS (\n\tSELECT u.id\n\tFROM \"User\" u, v\n\tWHERE u.id = v.uid AND u.\"businessId\" = v.bid\n)\nUPDATE \"User\" u\nSET\n  role  = COALESCE(NULLIF(v.role_raw, ''), u.role),\n  \"firstName\" = COALESCE(v.first_name, u.\"firstName\"),\n  \"lastName\"  = COALESCE(v.last_name,  u.\"lastName\"),\n  \"phone\"     = COALESCE(v.phone,      u.\"phone\"),\n  \"isActive\"  = COALESCE(v.is_active,  u.\"isActive\"),\n  \"updatedBy\"      = upd_by.updated_by_id,\n  \"updatedByEmail\" = v.updated_by_email\nFROM v\nLEFT JOIN upd_by ON TRUE\nJOIN to_update tu ON tu.id = u.id\nRETURNING\n  u.id, u.email, u.role, u.\"isActive\",\n  u.\"firstName\", u.\"lastName\", u.\"phone\",\n  u.\"updatedAt\", u.\"updatedBy\", u.\"updatedByEmail\";\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "AxiomaDB",
      "isAutoGenerated": false,
      "name": "AxiomaDB",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "q_user_update",
    "pageId": "Dashboard",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}