WITH inp AS (
  SELECT
    {{ this.params.token }}::text  AS token,
    {{ this.params.businessId || null }}::uuid AS business_id
)
SELECT c."customerId"
FROM "CustomerQrToken" c, inp
WHERE c."token" = inp.token
  AND (inp.business_id IS NULL OR c."businessId" = inp.business_id)
LIMIT 1;
