{
  "gitSyncId": "68f1ea66301c3b6f3e13c5f4_7da5181f-c080-444d-b9a4-25ada2c38f07",
  "id": "Dashboard_q_update_customer",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH p AS (\n  SELECT ({{ (Auth.businessId && Auth.businessId()) || appsmith.store.businessId }})::uuid AS bid\n),\ninp AS (\n  SELECT\n    {{ this.params.id ?? '' }}::text           AS id_txt,\n    {{ this.params.name ?? '' }}::text         AS name_txt,\n    {{ this.params.phone ?? '' }}::text        AS phone_txt,\n    {{ this.params.email ?? '' }}::text        AS email_txt,\n    {{ this.params.notes ?? '' }}::text        AS notes_txt,\n    {{ this.params.birthday ?? '' }}::text     AS birthday_txt,\n    UPPER(TRIM({{ this.params.tag ?? '' }}::text)) AS tag_txt   -- üß† Forzamos may√∫sculas limpias\n)\nUPDATE \"Customer\" c\nSET\n  name        = NULLIF(TRIM(i.name_txt), ''),\n  phone       = CASE\n                  WHEN NULLIF(i.phone_txt,'') IS NOT NULL\n                  THEN '+34' || RIGHT(REGEXP_REPLACE(i.phone_txt, '[^0-9]', '', 'g'), 9)\n                  ELSE NULL\n                END,\n  email       = NULLIF(i.email_txt, ''),\n  notes       = NULLIF(i.notes_txt, ''),\n  birthday    = CASE\n                  WHEN NULLIF(i.birthday_txt,'') IS NULL THEN NULL\n                  WHEN i.birthday_txt ~ '^\\d{4}-\\d{2}-\\d{2}$'\n                       THEN (i.birthday_txt::date)::timestamp\n                  ELSE (i.birthday_txt::timestamp)\n                END,\n  tag         = COALESCE(NULLIF(i.tag_txt, ''), 'NONE'),   -- usa 'NONE' si vac√≠o\n  \"updatedAt\" = now()\nFROM p, inp i\nWHERE c.id = (i.id_txt)::uuid\n  AND c.\"businessId\" = p.bid\nRETURNING\n  c.id, c.\"businessId\", c.name, c.phone, c.email, c.notes, c.birthday, c.tag, c.\"createdAt\", c.\"updatedAt\";\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "AxiomaDB",
      "isAutoGenerated": false,
      "name": "AxiomaDB",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "q_update_customer",
    "pageId": "Dashboard",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}