{
  "gitSyncId": "68f1ea66301c3b6f3e13c5f4_96185ab3-63a3-4b8c-b9fc-bf108505457b",
  "id": "Dashboard_q_clientes_bonos_vencidos",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH p AS (\n  SELECT\n    {{ appsmith.store.businessId }}::uuid AS bid,\n    {{ DateIni.selectedDate }}::date      AS d1,\n    {{ DateFin.selectedDate }}::date      AS d2\n),\nfechas AS (\n  SELECT\n    b.*,\n    bp.name AS plan_name,\n    bp.\"durationDays\",\n    bp.\"graceEndDay\",\n    -- vence cuando pasa la duración + fin de gracia\n    (b.\"startedAt\"::date\n      + ((bp.\"durationDays\" + COALESCE(bp.\"graceEndDay\",0)) || ' days')::interval\n    )::date AS vence_con_gracia\n  FROM \"Bond\" b\n  JOIN \"BondPlan\" bp ON bp.id = b.\"planId\"\n)\nSELECT \n  f.id                                           AS \"ID Bono\",\n  c.name                                         AS \"Cliente\",\n  f.plan_name                                    AS \"Plan\",\n  f.\"durationDays\"                               AS \"Duración\",\n  f.\"startedAt\"                                  AS \"Fecha de Inicio\",\n  f.vence_con_gracia                             AS \"Fecha de Vencimiento\",\n  GREATEST(0, (current_date - f.vence_con_gracia))::int AS \"Días Vencido\",\n  f.status                                       AS \"Estado\"\nFROM fechas f\nJOIN \"Customer\" c ON c.id = f.\"customerId\"\nJOIN p ON TRUE\nWHERE c.\"businessId\" = p.bid\n  AND f.plan_name ILIKE '%VIP%'\n  AND f.\"durationDays\" = 30\n  AND f.\"startedAt\"::date BETWEEN p.d1 AND p.d2\n  AND current_date > f.vence_con_gracia\nORDER BY f.\"startedAt\" DESC;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "AxiomaDB",
      "isAutoGenerated": false,
      "name": "AxiomaDB",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "q_clientes_bonos_vencidos",
    "pageId": "Dashboard",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}