{
  "gitSyncId": "68f1ea66301c3b6f3e13c5f4_f84ff7a7-53bf-4097-944a-4a5d2a020d86",
  "id": "Dashboard_getFallbackVisitsCount",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH last_free AS (\n  SELECT COALESCE(MAX(r.\"redeemedAt\"), '1970-01-01'::timestamptz) AS since\n  FROM \"Reward\" r\n  WHERE r.\"customerId\" = {{ appsmith.store.selCustomerId }}::uuid\n    AND r.kind = 'free'\n    AND r.status = 'REDEEMED'\n)\nSELECT\n  'Default'          AS \"planName\",\n  10                 AS \"totalSlots\",\n  (\n    SELECT COUNT(1)\n    FROM \"Visit\" v, last_free lf\n    WHERE v.\"customerId\" = {{ appsmith.store.selCustomerId }}::uuid\n      AND v.\"visitedAt\" > lf.since\n  )                  AS \"currentVisits\",\n  (SELECT since FROM last_free) AS \"cycleStart\",\n  FALSE AS \"halfIssued\",\n  FALSE AS \"freeIssued\",\n  FALSE AS \"isVip\";\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "AxiomaDB",
      "isAutoGenerated": false,
      "name": "AxiomaDB",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "getFallbackVisitsCount",
    "pageId": "Dashboard",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}