SELECT
  v.id,
  v."customerId",
  v."visitedAt"      AS fecha,
  v.notes,
  /* claves de mes opcionales para el filtro */
  to_char(v."visitedAt", 'YYYY-MM') AS mes_key,
  to_char(v."visitedAt", 'Mon / YYYY') AS mes_label
FROM "Visit" v
WHERE ( '{{this.params.customerId}}' = '' OR v."customerId" = '{{this.params.customerId}}'::uuid )
ORDER BY v."visitedAt" DESC
LIMIT {{ this.params.limit || 100 }}
OFFSET {{ this.params.offset || 0 }};
