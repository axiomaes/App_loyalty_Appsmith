{
  "gitSyncId": "68f1ea66301c3b6f3e13c5f4_cc271fed-07ec-491a-ab18-3d62f93a2992",
  "id": "Dashboard_q_bondplans_upsert",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH v AS (\n  SELECT\n    {{ appsmith.store.businessId }}::uuid AS bid,\n    trim({{ this.params.code }}::text)    AS code,\n    trim({{ this.params.name }}::text)    AS name,\n    {{ this.params.priceCents }}::int     AS price_cents,\n    {{ this.params.durationDays }}::int   AS duration_days,\n    {{ this.params.graceStartDay }}::int  AS g_start,\n    {{ this.params.graceEndDay }}::int    AS g_end,\n    {{ this.params.isActive }}::boolean   AS is_active\n),\n\nchk AS (\n  SELECT\n    (code <> '')                   AS ok_code,\n    (name <> '')                   AS ok_name,\n    (price_cents >= 0)             AS ok_price,\n    (duration_days > 0)            AS ok_dur,\n    (g_start BETWEEN 1 AND 31)     AS ok_gs,\n    (g_end   BETWEEN 1 AND 31)     AS ok_ge,\n    (g_start <= g_end)             AS ok_range\n  FROM v\n),\n\ngo AS (\n  SELECT 1\n  FROM chk\n  WHERE ok_code AND ok_name AND ok_price AND ok_dur AND ok_gs AND ok_ge AND ok_range\n)\n\nINSERT INTO \"BondPlan\"(\n  id, \"businessId\", code, name,\n  \"priceCents\", \"durationDays\", \"graceStartDay\", \"graceEndDay\", \"isActive\"\n)\nSELECT\n  uuid_generate_v4(),  -- id nuevo si inserta\n  v.bid, v.code, v.name,\n  v.price_cents, v.duration_days, v.g_start, v.g_end, v.is_active\nFROM v, go\nON CONFLICT (\"businessId\",\"code\") DO UPDATE SET\n  name            = EXCLUDED.name,\n  \"priceCents\"    = EXCLUDED.\"priceCents\",\n  \"durationDays\"  = EXCLUDED.\"durationDays\",\n  \"graceStartDay\" = EXCLUDED.\"graceStartDay\",\n  \"graceEndDay\"   = EXCLUDED.\"graceEndDay\",\n  \"isActive\"      = EXCLUDED.\"isActive\"\nRETURNING\n  id, \"businessId\", code, name,\n  \"priceCents\", \"durationDays\", \"graceStartDay\", \"graceEndDay\", \"isActive\",\n  CASE WHEN xmax = 0 THEN 'inserted' ELSE 'updated' END AS op;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "AxiomaDB",
      "isAutoGenerated": false,
      "name": "AxiomaDB",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "q_bondplans_upsert",
    "pageId": "Dashboard",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}